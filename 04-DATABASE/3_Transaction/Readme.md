## 트랜잭션
> - 트랜잭션이란 여러 개의 작업을 하나로 묶은 실행 유닛
> - 데이터베이스의 상태를 변환시키는 기능을 수행하기 위한 하나 이상의 쿼리를 모아 놓은 `작업 단위`
> - 데이터베이스에서 데이터의 일관성, 신뢰성, 안정성을 보장하기 위한 기본적인 원칙
> - 트랜잭션은 ACID라는 특성을 가지고 있다.
> - 여러 개의 DML 명령문이 한 트랜잭션 안에 포함되어 있으며, 명령문들은 하나의 `논리적 단위`로써 처리된다.
>   - 이후, commit과 rollback같은 TCL 명령문으로 트랜잭션을 제어한다.
> - [@Transactional](..%2F..%2F07-JAVA_SPRING%2F16_Transactional%2FReadme.md)

## ACID
> - 데이터베이스 내에서 일어나는 하나의 트랜잭션의 안전성을 보장하기 위해 필요한 성질

### Atomicity(원자성)
> - 트랜잭션이 안전성 보장을 위해 가져야 할 성질 중의 하나
> - 시스템에서 한 트랜잭션의 연산들이 모두 성공하거나, 반대로 전부 실패되는 성질
>   - 작업이 모두 반영되거나 모두 반영되지 않음으로서 결과를 예측할 수 있어야 한다.
>   - 모두 성공하면 COMMIT, 하나라도 실패하면 ROLLBACK
>   - All or Nothing

### Consistency(일관성)
> - 트랜잭션 이후, 데이터나 시스템이 가지고 있는 고정요소나 상태가 수행 전과 후의 상태가 같아야 한다.
> - 기본 키, 외래 키 제약과 같은 무결성 제약 조건들과 비명시적인 일관성 조건이 유지되어야 한다.

### Isolation(고립성)
> - 하나의 트랜잭션 수행 시, 다른 트랜잭션의 작업이 끼어들지 못하도록 보장하며 다른 트랜잭션의 영향 또는 간섭을 받지 않는 것
> - 동시에 여러 개의 트랜잭션이 실행될 때, 다른 트랜잭션의 작업 내용을 알 수 없다.

### Durability(지속성)
> - 하나의 트랜잭션이 성공적으로 수행되고 난 뒤, 해당 트랜잭션에 대한 로그가 남아서 저장되어야 하는 것
> - 성공한 트랜잭션의 결과는 안정적으로 보존되어야 하며, 영구적으로 데이터베이스에 반영되어야 함

--
## ACID 원칙 중, Durability를 DBMS는 어떻게 보장하나요?
### 로그 기반 아키텍처(Write-Ahead Logging, WAL)
> - 트랜잭션의 변경 사항을 데이터베이스에 반영하기 전에(커밋하기 전에), 해당 변경 사항을 먼저 로그 파일에 기록
> - 로그 파일에는 트랜잭션의 시작, 변경된 데이터, 완료 상태 등이 기록
> - 커밋이 실행되면, 로그 파일에 기록된 내용을 기반으로 실제 데이터베이스 파일에 변경 사항 반영
>   - 그래서 커밋이 실행되고, 시스템 충돌이나 장애가 발생하더라도 `이미 로그는 디스크에 쓰여졌기` 때문에,
>   - 그 로그를 기반으로 데이터베이스를 복구할 수 있게 된다는 것

> - 트랜잭션이 커밋되기 전에 그에 대한 로그 기록이 먼저 디스크에 쓰여짐
> - 시스템이 중단되거나 장애가 발생하면, DBMS는 이 로그를 사용하여 트랜잭션의 결과를 복구하거나 롤백할 수 있다.
> - 트랜잭션이 완료되고 장애가 발생하더라도 디스크에 쓰여진 로그를 통해 데이터를 안전하게 복구 가능

### 체크포인트
> - 데이터베이스 시스템이 `일정한 간격`으로 현재까지의 모든 변경 사항을 데이터 파일에 반영하고, 로그 파일의 일부를 삭제할 수 있게 하는 메커니즘

> - 체크포인트가 생성되면, 그 시점까지 커밋된 모든 트랜잭션의 데이터는 데이터베이스 파일에 영구적으로 기록
> - 이후 `로그 파일은 이 시점 이후의 트랜잭션만을 추적`하게 된다.

## 읽기에는 트랜잭션을 걸지 않아도 될까요?
### 읽기 작업에서 트랜잭션을 사용해야 하는 경우
> - 트랜잭션을 사용하면 동일한 트랜잭션 내에서 여러 번의 읽기 작업을 수행할 때,
> - 데이터베이스의 일관된 상태를 보장할 수 있다.
>   - 한 트랜잭션 안에서 여러 번의 읽기가 발생해야 하는 경우(여러 테이블에서 데이터를 읽어야 하는 경우)
>   - 읽기 작업 중간에는 데이터가 변경되지 않는 다는 것을 보장

### 읽기 작업에서 트랜잭션을 사용해야 하지 말아야 하는 경우
> - 트랜잭션을 사용하면 데이터베이스에서 LOCK이나 격리 비용이 발생할 수 있어서 성능 저하로 이어질 수 있다.
>   - 높은 트래픽을 처리하는 경우, 불필요한 트랜잭션 사용은 시스템의 성능 저하

#### ORM의 경우 읽기 전용 트랜잭션을 이용하여 성능을 올릴 수 있다.
> - @Transactional(readOnly=true)
>   - 트랜잭션을 걸지 않는다는 의미가 아니다.
>   - 읽기 전용 트랜잭션을 설정한다는 것
>   - ORM에서는 변경 감지가 발생하지 않도록 성능 최적화